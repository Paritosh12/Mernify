// src/App.jsx
import React, { useState } from 'react';
import Sidebar from './components/Layout/Sidebar';
import Header from './components/Layout/Header';
import Dashboard from './pages/Dashboard';
import LibraryView from './pages/LibraryView';
import PromptDetailPage from './pages/PromptDetailPage'; // New Import
import ReviewRequestModal from './components/Modals/ReviewRequestModal';
import AuthView from './pages/AuthView';

const App = () => {
    const [currentPage, setCurrentPage] = useState('dashboard');
    const [isModalOpen, setIsModalOpen] = useState(false);
    // New state to manage selected workspace and prompt viewing
    const [selectedWorkspaceId, setSelectedWorkspaceId] = useState(1);
    const [viewingPromptId, setViewingPromptId] = useState(null);
    const [searchQuery, setSearchQuery] = useState('');

    const [isAuthenticated, setIsAuthenticated] = useState(false); 
    const handleAuthSuccess = () => {
        setIsAuthenticated(true);
        setCurrentPage('dashboard');
    };
    const handlePageChange = (page) => {
        
            if (page !== currentPage) {
                setSearchQuery(''); // Reset search when switching main views
                setCurrentPage(page); 
            }
    
            setViewingPromptId(null);
    
            if (page === 'requests') {
                setIsModalOpen(true);
                setCurrentPage('dashboard');
            } else {
                setIsModalOpen(false);
            }
    };
    
    const handlePromptSelect = (promptId) => {
        setCurrentPage('prompt-detail');
        setViewingPromptId(promptId);
    };
    
    const handleBackToLibrary = () => {
        setCurrentPage('library');
        setViewingPromptId(null);
    };

    const handleViewWorkspace = (workspaceId) => {
      setSelectedWorkspaceId(workspaceId);
      setCurrentPage('library');
    };

    const renderPage = () => {
        if (viewingPromptId) {
            // Render the dedicated prompt detail page
            return <PromptDetailPage goBackToLibrary={handleBackToLibrary} />;
        }
        
        switch (currentPage) {
            case 'dashboard':
              return <Dashboard 
                    showRequests={() => setIsModalOpen(true)} 
                    onPromptClick={() => handlePromptSelect(1)}
                    //  PASSING THE NEW HANDLER TO THE DASHBOARD
                    onViewWorkspace={handleViewWorkspace}
                    setCurrentPage={handlePageChange}
                    searchQuery={searchQuery}
              />;
            case 'requests':
                console.log(currentPage);
                // Dashboard now passes the select handler to navigate to the new detail view
                return <ReviewRequestModal
                isOpen={isModalOpen} 
                onClose={() => {
                  
                  setIsModalOpen(false);
                                
                }} 
                  // Mock select for trending
                />;
            case 'library':
                return <LibraryView 
                    onPromptSelect={handlePromptSelect} 
                    selectedWorkspaceId={selectedWorkspaceId}
                    searchQuery={searchQuery}
                />;
            case 'prompt-detail': // <--- NEW CASE ADDED HERE
            return <PromptDetailPage 
                goBackToLibrary={handleBackToLibrary} 
                // In a real app, you would pass the actual prompt data based on viewingPromptId
            />;

            default:
                return <Dashboard showRequests={() => setIsModalOpen(true)} onPromptClick={() => handlePromptSelect(1)} />;
        }
    };

    return (
        <div id="app" className="font-inter">
            {!isAuthenticated ? (
                <AuthView onAuthSuccess={handleAuthSuccess} />
            ) : (
                <div className="flex h-screen overflow-hidden bg-bg-primary">
                    <Sidebar 
                        currentPage={currentPage} 
                        setCurrentPage={handlePageChange}
                        setSelectedWorkspaceId={setSelectedWorkspaceId} 
                    />

                    <main id="main-content" className="flex-1 p-8 overflow-y-auto">
                        <Header 
                            currentPage={currentPage} 
                            searchQuery={searchQuery}
                            setSearchQuery={setSearchQuery}
                        />
                        <div id="page-content" className="w-full">
                            {renderPage()}
                        </div>
                    </main>
                    
                    <ReviewRequestModal 
                        isOpen={isModalOpen} 
                        onClose={() => {setIsModalOpen(false);}} 
                    />
                </div>
            )}
        </div>
    );
};

export default App;





// src/components/Layout/Sidebar.jsx
import { Zap, Home, HardHat, FileText, Compass, Plus, ChevronDown, ChevronRight } from 'lucide-react';
import React, { useState } from 'react';

const mockWorkspaces = [
    { id: 1, name: "Dev Team Prompts" },
    { id: 2, name: "Marketing Campaigns" },
    { id: 3, name: "Hackathon Squad" },
];

const NavItem = ({ Icon, name, isActive, onClick, isDropdown = false, isOpen = false }) => (
    <a 
        href="#"
        onClick={onClick}
        className={`flex items-center p-3 rounded-lg transition text-sm ${
            isActive ? 'bg-accent-teal text-white font-semibold' : 'text-white hover:bg-zinc-800'
        } ${isDropdown ? 'justify-between' : ''}`}
    >
        <span className="flex items-center">
            <Icon className="mr-3 w-5 h-5" />
            {name}
        </span>
        {isDropdown && (isOpen ? <ChevronDown className="w-4 h-4" /> : <ChevronRight className="w-4 h-4" />)}
    </a>
);

const Sidebar = ({ currentPage, setCurrentPage, setSelectedWorkspaceId ,mockWorkspaces}) => {
    const [isWorkspaceOpen, setIsWorkspaceOpen] = useState(false);

    const handleWorkspaceSelect = (id) => {
        setSelectedWorkspaceId(id); // Update selected workspace state
        setCurrentPage('library'); // Navigate to the library view
    };

    return (
        <aside className="bg-surface-card h-full p-4 flex flex-col justify-between w-64 flex-shrink-0">
            <div>
                <div className="text-3xl font-bold mb-8 flex items-center text-accent-teal">
                    <Zap className="mr-2 w-6 h-6" /> promptly
                </div>
                <nav className="space-y-2 text-sm">
                    <NavItem Icon={Home} name="Home" isActive={currentPage === 'dashboard'} onClick={() => setCurrentPage('dashboard')} />
                    
                    {/* My Workspace (Dropdown Toggle) */}
                    <NavItem 
                        Icon={HardHat} 
                        name="My Workspace" 
                        isActive={currentPage === 'library'} 
                        isDropdown={true}
                        isOpen={isWorkspaceOpen}
                        onClick={() => setIsWorkspaceOpen(!isWorkspaceOpen)} 
                    />
                    
                    {/* Workspace Dropdown Content */}
                    {isWorkspaceOpen && (
                        <div className="pl-6 space-y-1">
                            {mockWorkspaces.map(ws => (
                                <a 
                                    key={ws.id}
                                    href="#" 
                                    onClick={() => handleWorkspaceSelect(ws.id)}
                                    className="block p-2 rounded-lg text-zinc-300 hover:bg-zinc-700 transition"
                                >
                                    {ws.name}
                                </a>
                            ))}
                        </div>
                    )}
                    
                    <NavItem Icon={FileText} name="Requests" isActive={currentPage === 'requests'} onClick={() => setCurrentPage('requests')} />
                    <NavItem Icon={Compass} name="Explore" isActive={currentPage === 'explore'} onClick={() => alert('Explore clicked')} />
                </nav>
            </div>
            <div className="mt-8">
                <button className="flex items-center p-3 rounded-lg text-white hover:bg-zinc-800 transition w-full text-sm">
                    <Plus className="mr-3 w-5 h-5" /> Add Workspace
                </button>
                <div className="flex items-center justify-between p-3 mt-4 bg-surface-secondary rounded-xl">
                    <span className="text-sm">John Doe</span>
                    <div className="w-8 h-8 rounded-full bg-accent-teal flex items-center justify-center text-xs text-white">JD</div>
                </div>
            </div>
        </aside>
    );
};

export default Sidebar;



// src/pages/LibraryView.jsx
import React, { useState } from 'react';
import PromptCard from '../components/Common/PromptCard';
import { Plus } from 'lucide-react';
import Button from '../components/Common/Button';

// Sample Data (Initialized with mutable state for demonstration)
const initialPrompts = [
    { id: 1, task: "Next.js Component with Tailwind", upvotes: 45, creator: "Alice Johnson", isUpvoted: false },
    { id: 2, task: "Kubernetes Deployment YAML Generator", upvotes: 38, creator: "Bob Johnson", isUpvoted: false },
    { id: 3, task: "Advanced SQL Join Query", upvotes: 35, creator: "Charlie Brown", isUpvoted: false },
    { id: 4, task: "Functional Component Unit Test Template", upvotes: 29, creator: "Alice Johnson", isUpvoted: false },
];

const LibraryView = ({ onPromptSelect, selectedWorkspaceId, searchQuery }) => {
    
    const [prompts, setPrompts] = useState(initialPrompts); // State to hold prompt data
    
    const workspaceName = selectedWorkspaceId === 1 ? "Dev Team Prompts" : "Selected Workspace";

    // NEW: Upvote Handler
    const handleUpvote = (id) => {
        setPrompts(prevPrompts => 
            prevPrompts.map(p => {
                if (p.id === id) {
                    const newUpvotes = p.isUpvoted ? p.upvotes - 1 : p.upvotes + 1;
                    return {
                        ...p,
                        upvotes: newUpvotes,
                        isUpvoted: !p.isUpvoted,
                    };
                }
                return p;
            })
        );
        // In a real app: API call (e.g., POST /api/prompts/{id}/upvote)
        console.log(`Prompt ${id} upvote state toggled.`);
    };

    // Filtering logic based on searchQuery
    const filteredPrompts = prompts.filter(p =>
        p.task.toLowerCase().includes(searchQuery.toLowerCase())
    );

    return (
        <div className="flex h-full -mt-8">
            <div className="w-full pr-6 flex flex-col">
                <h2 className="text-3xl font-semibold text-text-primary mb-4">{workspaceName}</h2>
                <div className="flex justify-between items-center mb-4">
                    <div className="flex space-x-2 text-sm">
                        <Button variant="secondary">Top Rated</Button>
                        <Button variant="default" className="text-zinc-400">Pending Updates</Button>
                    </div>
                    <Button variant="primary">
                        <Plus className="w-4 h-4 mr-2" /> New Prompt
                    </Button>
                </div>
                <div className="overflow-y-auto prompt-feed-list space-y-3 pr-2">
                    {filteredPrompts.map((p) => (
                        <PromptCard 
                            key={p.id}
                            id={p.id} 
                            task={p.task}
                            upvotes={p.upvotes}
                            isUpvoted={p.isUpvoted} // Pass current upvote status
                            onClick={() => onPromptSelect(p.id)} 
                            onUpvote={() => handleUpvote(p.id)} // Pass the handler
                        />
                    ))}
                    {/* ... (empty state logic) ... */}
                </div>
            </div>
        </div>
    );
};

export default LibraryView;